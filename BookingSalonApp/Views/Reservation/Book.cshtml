@using BookingSalonApp.Models
@model BookingSalonApp.Models.BookingViewModel

<div class="container mt-5">
    <div class="card shadow-lg p-4 booking-card">
        <h1 class="text-center mb-4 booking-title">📅 Rezervirajte Termin</h1>

        <form asp-action="Book" method="post">
            <input type="hidden" asp-for="SalonId" />
            <input type="hidden" asp-for="SalonName" />

            <!-- Odabir Usluga -->
            <div class="mb-4">
                <label class="form-label fw-bold">💈 Odaberite Usluge:</label>
                <div class="services-list">
                    @if (Model.Services != null && Model.Services.Any())
                    {
                        @foreach (var service in Model.Services)
                        {
                            <div class="form-check service-item">
                                <input type="checkbox" name="SelectedServices" value="@service.Id" class="form-check-input" id="service-@service.Id" />
                                <label class="form-check-label" for="service-@service.Id">
                                    @service.Name - <strong>@service.Price.ToString("C")</strong>
                                </label>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-danger">Nema dostupnih usluga!</p>
                    }
                </div>
            </div>

            <!-- Odabir Zaposlenika -->
            <div class="mb-4">
                <label class="form-label fw-bold">👨‍🔧 Odaberite Zaposlenika:</label>
                <select asp-for="EmployeeId" class="form-select" required id="employeeSelect">
                    <option value="">-- Odaberite Zaposlenika --</option>
                    @if (Model.Employees != null && Model.Employees.Any())
                    {
                        @foreach (var employee in Model.Employees)
                        {
                            <option value="@employee.Id">@employee.Name</option>
                        }
                    }
                    else
                    {
                        <option value="">Nema dostupnih zaposlenika</option>
                    }
                </select>
            </div>

            <!-- Slobodni Termini -->
            <div class="mb-4">
                <label class="form-label fw-bold">🕒 Slobodni Termini:</label>
                <select id="availableSlots" class="form-select" required>
                    <option value="">Odaberite zaposlenika i datum</option>
                </select>
            </div>

            <!-- Gumb za Slanje -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary btn-lg booking-button">
                    ✅ Potvrdi Rezervaciju
                </button>
            </div>
        </form>

        <!-- Pregled Validacije -->
        <div asp-validation-summary="All" class="text-danger mt-3"></div>
    </div>
</div>

<!-- Prilagođeni CSS -->
<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .booking-card {
        border-radius: 15px;
        background: white;
        padding: 30px;
    }

    .booking-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #343a40;
    }

    .services-list {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
    }

    .service-item {
        margin-bottom: 10px;
    }

    .form-select {
        border-radius: 10px;
        padding: 0.75rem;
        font-size: 1rem;
    }

    .booking-button {
        background-color: #007bff;
        border: none;
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 10px;
        transition: background-color 0.3s ease;
    }

        .booking-button:hover {
            background-color: #0056b3;
        }

    .text-danger {
        font-size: 0.9rem;
    }
</style>

<!-- JavaScript za dinamičko učitavanje slobodnih termina -->
<script>
    document.getElementById("employeeSelect").addEventListener("change", updateAvailableSlots);
    document.getElementById("dateSelect").addEventListener("change", updateAvailableSlots);

    async function updateAvailableSlots() {
        var employeeId = document.getElementById("employeeSelect").value;
        var date = document.getElementById("dateSelect").value;

        if (employeeId && date) {
            var response = await fetch(`/Reservation/GetAvailableSlots?employeeId=${employeeId}&date=${date}`);
            var availableSlots = await response.json();

            var slotSelect = document.getElementById("availableSlots");
            slotSelect.innerHTML = "<option value=''>Odaberite Termin</option>"; // Resetiraj dostupne termine

            if (availableSlots.length > 0) {
                availableSlots.forEach(function (slot) {
                    var option = document.createElement("option");
                    option.value = slot;
                    option.textContent = slot;
                    slotSelect.appendChild(option);
                });
                slotSelect.disabled = false;
            } else {
                var option = document.createElement("option");
                option.value = "";
                option.textContent = "Nema slobodnih termina";
                slotSelect.appendChild(option);
                slotSelect.disabled = true;
            }
        }
    }
</script>
